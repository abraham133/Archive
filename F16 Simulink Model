
%% F16 matrice ~ 20000 ft 600 ft/sec  xcg = 0.3
% x = [Va    ;   h   ;   alpha   ; theta   ;   q    ;  power ;    beta  ;    phi   ;    p     ;   r  ;  psi]
A =[-0.0131    0.0000   21.6813  -31.6936   -0.8206    0.2280    0.0000   -0.0000   -0.0000   -0.0000   0
    -0.0000         0 -591.0404  591.0404         0         0         0    0.0000         0         0   0
    -0.0002    0.0000   -0.7485   -0.0000    0.9482   -0.0000   -0.0000         0    0.0000    0.0000   0
          0         0         0         0    1.0000         0         0         0         0         0   0
     0.0000   -0.0000   -1.4588         0   -0.8897         0   -0.0000         0         0   -0.0029   0
          0         0         0         0         0   -1.0000         0         0         0         0   0
     0.0000   -0.0000    0.0000   -0.0000   -0.0000    0.0000   -0.1967    0.0527    0.0594   -0.9941   0
          0         0         0         0         0         0         0         0    1.0000    0.0595   0
    -0.0000    0.0000    0.0000         0    0.0003         0  -19.6461         0   -2.3178    0.4926   0
    -0.0000    0.0000    0.0000         0    0.0025         0    7.5107         0   -0.0294   -0.3191   0
          0         0         0         0         0         0         0         0         0         1   0];





% u = [throttle ; elevator ; aileron ; rudder]
B = [    0     0.1094        0         0  
         0         0         0         0
         0   -0.0014         0         0
         0         0         0         0
         0   -0.1389         0         0
   34.3908         0         0         0
         0    0.0000    0.0002    0.0005
         0         0         0         0
         0         0   -0.5624    0.0983
         0         0   -0.0246   -0.0491
         0         0         0         0];



%output y = [an ; q ; alpha]
C = [    0.0033   -0.0000   14.3292    0    0.9659         0         0         0         0         0
         0         0         0         0    1.0000         0         0         0         0         0
         0         0   57.2958         0         0         0         0         0         0         0];

%output y = [Va ;   h    ;  alpha   ; theta   ;  q    ;  power ;   beta  ;    phi   ;    p     ;   r    ;   psi]
C = [    1.0000    0         0         0         0         0         0         0         0         0         0
         0    1.0000         0         0         0         0         0         0         0         0         0
         0         0   57.2958         0         0         0         0         0         0         0         0
         0         0         0   57.2958         0         0         0         0         0         0         0
         0         0         0         0   57.2958         0         0         0         0         0         0
         0         0         0         0         0         1         0         0         0         0         0
         0         0         0         0         0         0   57.2958         0         0         0         0
         0         0         0         0         0         0         0   57.2958         0         0         0
         0         0         0         0         0         0         0         0   57.2958         0         0
         0         0         0         0         0         0         0         0         0  57.2958          0 
         0         0         0         0         0         0         0         0         0         0   57.2958];

% bunu kullanacak mıyız???
D = [    0    0.0254         0         0
         0         0         0         0
         0         0         0         0];
     

D = [    0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0];     


     
     
%% F16 matrice ~ 15000 ft 500 ft/sec  xcg = 0.35
% % x = [Va    ;   h   ;   alpha   ; theta   ;   q    ;  power ;    beta  ;    phi   ;    p     ;   r]
% A =[-0.0151    0.0000   10.9540  -31.6936   -1.1127    0.2572    0.0000   -0.0000   -0.0000     0
%          0         0 -492.5337  492.5337         0         0         0    0.0000         0      0
%    -0.0003    0.0000   -0.7244   -0.0000    0.9380   -0.0000   -0.0000         0    0.0000      0
%          0         0         0         0    1.0000         0         0         0         0      0
%    -0.0000    0.0000    1.2193         0   -0.6784         0         0         0         0   -0.0029
%          0         0         0         0         0   -1.0000         0         0         0      0
%     0.0000   -0.0000    0.0000   -0.0000   -0.0000    0.0000   -0.1936    0.0632    0.0743    -0.9923
%          0         0         0         0         0         0         0         0    1.0000  0.0742
%     0.0000   -0.0000    0.0000         0    0.0003         0  -17.2478         0   -2.2605  0.5306
%    -0.0000    0.0000    0.0000         0    0.0025         0    5.5404         0   -0.0370  -0.3002];
% 
% 
% 
% 
% 
% % u = [throttle ; elevator ; aileron ; rudder]
% B = [    0    0.0773   -0.0000   -0.0000
%          0         0         0         0
%          0   -0.0014         0         0
%          0         0         0         0
%          0   -0.1094         0         0
%    33.8925         0         0         0
%          0    0.0000    0.0002    0.0005
%          0         0         0         0
%          0         0   -0.4625    0.0798
%          0         0   -0.0194   -0.0388];
% 
% 
% 
% %output y = [an ; q ; alpha]
% C = [    0.0033   -0.0000   14.3292    0    0.9659         0         0         0         0         0
%          0         0         0         0    1.0000         0         0         0         0         0
%          0         0   57.2958         0         0         0         0         0         0         0];
% 
% %output y = [Va ;   h    ;  alpha   ; theta   ;  q    ;  power ;   beta  ;    phi   ;    p     ;   r]
% C = [    1.0000    0         0         0         0         0         0         0         0         0
%          0    1.0000         0         0         0         0         0         0         0         0
%          0         0         1         0         0         0         0         0         0         0
%          0         0         0         1         0         0         0         0         0         0
%          0         0         0         0         1         0         0         0         0         0
%          0         0         0         0         0         1         0         0         0         0
%          0         0         0         0         0         0         1         0         0         0
%          0         0         0         0         0         0         0         1         0         0
%          0         0         0         0         0         0         0         0         1         0
%          0         0         0         0         0         0         0         0         0         1];
%     
% 
% % bunu kullanacak mıyız???
% D = [    0    0.0208         0         0
%          0         0         0         0
%          0         0         0         0];
%      
% 
% D = [    0         0         0         0
%          0         0         0         0
%          0         0         0         0
%          0         0         0         0
%          0         0         0         0
%          0         0         0         0
%          0         0         0         0
%          0         0         0         0
%          0         0         0         0
%          0         0         0         0];     

     
     

%% transfer functions

%% longitudinal

%for throttle
[a,b] = ss2tf(A(1:6,1:6),B(1:6,1),C(1:6,1:6),D(1:6,1));

GV_t = tf(a(1,:),b);
Gh_t = tf(a(2,:),b);
Galpha_t = tf(a(3,:),b);
Gtheta_t = tf(a(4,:),b);
Gq_t = tf(a(5,:),b);




%for elevator
[a,b] = ss2tf(A(1:6,1:6),B(1:6,2),C(1:6,1:6),D(1:6,2));

GV_e = tf(a(1,:),b);
Gh_e = tf(a(2,:),b);
Galpha_e = tf(a(3,:),b);
Gtheta_e = tf(a(4,:),b);
Gq_e = tf(a(5,:),b);



%% lateral

%for aileron
[a,b] = ss2tf(A(7:10,7:10),B(7:10,3),C(7:10,7:10),D(7:10,1));

Gbeta_a = tf(a(1,:),b);
Gphi_a = tf(a(2,:),b);
Gp_a = tf(a(3,:),b);
Gr_a = tf(a(4,:),b);




%for rudder
[a,b] = ss2tf(A(7:10,7:10),B(7:10,4),C(7:10,7:10),D(7:10,2));

Gbeta_r = tf(a(1,:),b);
Gphi_r = tf(a(2,:),b);
Gp_r = tf(a(3,:),b);
Gr_r = tf(a(4,:),b);




%% longitudinal motion - modern control theory LQR


Along = A(1:6,1:6);
Blong = B(1:6,1:2);
Clong = C(1:6,1:6);
Dlong = D(1:6,1:2);


sys = ss(Along,Blong,Clong,Dlong);


Q = eye(6);
R = 15;



diag=[5.8050
    2.3085
   16.3346
   18.7959
   48.1467
   16.0330
   29.8098];

 
%  diag=[9.9691
%     0.2660
%    23.8587
%    12.3699
%     7.4398
%    17.4579
%    23.0800];


Q = eye(5);
Q(1,1) = diag(1); 
Q(2,2) = diag(2);
Q(3,3) = diag(3); 
Q(4,4) = diag(4); 
Q(5,5) = diag(5);
Q(6,6) = diag(6);

R = diag(7);


Klqrlong = lqr(sys,Q,R);

Alqr = Along-Blong*Klqrlong;

sys = ss(Alqr,Blong,Clong,Dlong);

eig(Alqr)


%% transfer functions

%% longitudinal

% %for throttle
% [a,b] = ss2tf(Alqr,Blong(:,1),Clong,Dlong(:,1));
% 
% GV_t = tf(a(2,:),b);
% % zeroları göztermeye gerek yok çok büyük çıkıyor. polleri bunla aynı olan
% % tf salla pz map yap

% s = tf('s');
% G = 1 / ((s+1.0293 + 2.4237i)*(s+1.0293 - 2.4237i)*(s+2.2431 + 0.9631i)*(s+2.2431 - 0.9631i));
% pzmap(G)



%% simulation

% t = 0:0.01:10;
% u_step = [ones(1,length(t));
%           zeros(1,length(t))];
% u_zero = zeros(2,length(t));
% x0 = [0 ; 10 ; 0 ; 0 ; 0 ; 0];
% 
% [y,t,x] = lsim(sys,u_zero,t,x0);
% x = [Va    ;   h   ;   alpha   ; theta   ;   q    ;  power];

% [y ,t, x] = lsim(sys,u_zero,t,x0);
% 
% figure
% plot(t,x(:,1))
% grid
%  
% figure
% plot(t,x(:,2))
% grid
% 
% figure
% plot(t,x(:,3))
% grid

% figure
% plot(t,x(:,4))
% grid
% 
% figure
% plot(t,x(:,5))
% grid
% 
% figure
% plot(t,x(:,6))
% grid
clc, clear 


%% F16 matrice ~ 20000 ft 600 ft/sec  xcg = 0.3

%% initial condition

% x =           [  u    ; v ;      w    ; p ; q ; r ; theta ; phi ; psi ; pn ; pe ; h ; V ; alpha ; beta ; power ]

state_init = [ 598.9416 ; 0 ; 35.622639 ; 0 ; 0 ; 0 ;  0.01  ; 0.1 ;  0.1  ; ...
      0 ; 0 ; 19950 ; 590 ; 0.059405952482911 ; 0 ; 15.941298293587984];  %15.9414712



% x_long = [Va    ;   h   ;   alpha   ; theta   ;   q    ;  power]
x_long = [600 ; 20000 ; 0.059405952482911 ; 0.059405952482911 ; 0 ; 15.941298293587984];

% x_long = [beta  ;    phi   ;  p  ;  r  ; psi]
x_lat =   [   0   ;     0    ;  0  ;  0  ; 0];

th = 0.245477337443609;   %0.24548;
el = -2.205494777225563;
ail = 8.316800428880180e-15;
rud = -6.804083993307187e-14;

%% F16 matrice ~ 15000 ft 500 ft/sec  xcg = 0.35

%% initial condition 
% state_init = [ 498.6310701 ; 0 ; 36.97372005 ; 0 ; 0 ; 0 ; 0.074015 ; ...
%     0 ; 0 ; 0 ; 0 ; 15000 ; 500 ; 0.074015 ; 0 ; 12.18];
% 
% x_long = [500 ; 15000 ; 0.074015 ; 0.074015; 0 ; 12.18];
% 
% 
% th = 0.18756;
% el = -0.58435;
% ail = 1.8565e-11;
% rud = 0;


%% F16 nonlinear simulation lookup tables data

elevator = [-2 ; -1 ; 0 ; 1 ; 2];
AoA = [-2:9];
beta = [0:6];
%% Aerodynamic derivatives

% CX(alpha,elevator)(-2:9)(-2:2)
CX = [ -0.0990   -0.0480   -0.0220   -0.0400   -0.0830
       -0.0810   -0.0380   -0.0200   -0.0380   -0.0730
       -0.0810   -0.0400   -0.0210   -0.0390   -0.0760
       -0.0630   -0.0210   -0.0040   -0.0250   -0.0720
       -0.0250    0.0160    0.0320    0.0060   -0.0460
        0.0440    0.0830    0.0940    0.0620    0.0120
        0.0970    0.1270    0.1280    0.0870    0.0240
        0.1130    0.1370    0.1300    0.0850    0.0250
        0.1450    0.1620    0.1540    0.1000    0.0430
        0.1670    0.1770    0.1610    0.1100    0.0530
        0.1740    0.1790    0.1550    0.1040    0.0470
        0.1660    0.1670    0.1380    0.0910    0.0400 ];
    
    
% CZ(alpha)(-2:9) 
CZ = [ 0.770  0.241  -0.100  -0.416  -0.731  -1.053  -1.366 ...
                                -1.646  -1.917  -2.120  -2.248  -2.229 ];
%cz_value = s * ( 1 - ( beta / 57.3 ) ^ 2 ) - 0.19 * ( el / 25.0 );



% CL(alpha,beta)(-2:9)(0:6)
CL = [  .0     .0     .0     .0     .0     .0     .0     .0     .0     .0     .0     .0  ;
      -.001  -.004  -.008  -.012  -.016  -.022  -.022  -.021  -.015  -.008  -.013  -.015;
      -.003  -.009  -.017  -.024  -.030  -.041  -.045  -.040  -.016  -.002  -.010  -.019;
      -.001  -.010  -.020  -.030  -.039  -.054  -.057  -.054  -.023  -.006  -.014  -.027;
       .000  -.010  -.022  -.034  -.047  -.060  -.069  -.067  -.033  -.036  -.035  -.035;
       .007  -.010  -.023  -.034  -.049  -.063  -.081  -.079  -.060  -.058  -.062  -.059;
       .009  -.011  -.023  -.037  -.050  -.068  -.089  -.088  -.091  -.076  -.077  -.076 ]';


% dlda(alpha,beta)(-2:9)(-3:3)
CL2 = [ -.041  -.052  -.053  -.056  -.050  -.056  -.082  -.059  -.042  -.038  -.027  -.017;
      -.041  -.053  -.053  -.053  -.050  -.051  -.066  -.043  -.038  -.027  -.023  -.016;
      -.042  -.053  -.052  -.051  -.049  -.049  -.043  -.035  -.026  -.016  -.018  -.014;
      -.040  -.052  -.051  -.052  -.048  -.048  -.042  -.037  -.031  -.026  -.017  -.012;
      -.043  -.049  -.048  -.049  -.043  -.042  -.042  -.036  -.025  -.021  -.016  -.011;
      -.044  -.048  -.048  -.047  -.042  -.041  -.020  -.028  -.013  -.014  -.011  -.010;
      -.043  -.049  -.047  -.045  -.042  -.037  -.003  -.013  -.010  -.003  -.007  -.008 ]';


% dldr(alpha,beta)(-2:9)(-3:3)
CL3 = [ .005  .017  .014  .010  -.005  .009  .019  .005   .000  -.005  -.011  .008;
      .007  .016  .014  .014   .013  .009  .012  .005   .000   .004   .009  .007;
      .013  .013  .011  .012   .011  .009  .008  .005   .000   .005   .003  .005;
      .018  .015  .015  .014   .014  .014  .014  .015   .013   .011   .006  .001;
      .015  .014  .013  .013   .012  .011  .011  .010   .008   .008   .007  .003;
      .021  .011  .010  .011   .010  .009  .008  .010   .006   .005   .000  .001;
      .023  .010  .011  .011   .011  .010  .008  .010   .006   .014   .020  .000 ]';

  
 
  

% CM(alpha,elevator)(-2:9)(-2:2)
CM = [ .205   .168   .186   .196   .213   .251   .245   .238   .252   .231   .198   .192;
      .081   .077   .107   .110   .110   .141   .127   .119   .133   .108   .081   .093;
     -.046  -.020  -.009  -.005  -.006   .010   .006  -.001   .014   .000  -.013   .032;
     -.174  -.145  -.121  -.127  -.129  -.102  -.097  -.113  -.087  -.084  -.069  -.006;
     -.259  -.202  -.184  -.193  -.199  -.150  -.160  -.167  -.104  -.076  -.041  -.005  ]';


 
 
% CN(alpha,beta)(-2:9)(0:6)
CN = [ .0    .0    .0    .0    .0    .0    .0    .0    .0     .0     .0     .0  ;
      .018  .019  .018  .019  .019  .018  .013  .007  .004  -.014  -.017  -.033;
      .038  .042  .042  .042  .043  .039  .030  .017  .004  -.035  -.047  -.057;
      .056  .057  .059  .058  .058  .053  .032  .012  .002  -.046  -.071  -.073;
      .064  .077  .076  .074  .073  .057  .029  .007  .012  -.034  -.065  -.041;
      .074  .086  .093  .089  .080  .062  .049  .022  .028  -.012  -.002  -.013;
      .079  .090  .106  .106  .096  .080  .068  .030  .064   .015   .011  -.001 ]';

 
% dnda(alpha,beta)(-2:9)(-3:3)
CN2 = [  .001  -.027  -.017  -.013  -.012  -.016   .001   .017   .011  .017   .008  .016
       .002  -.014  -.016  -.016  -.014  -.019  -.021   .002   .012  .016   .015  .011
      -.006  -.008  -.006  -.006  -.005  -.008  -.005   .007   .004  .007   .006  .006
      -.011  -.011  -.010  -.009  -.008  -.006   .000   .004   .007  .010   .004  .010
      -.015  -.015  -.014  -.012  -.011  -.008  -.002   .002   .006  .012   .011  .011
      -.024  -.010  -.004  -.002  -.001   .003   .014   .006  -.001  .004   .004  .006
      -.022   .002  -.003  -.005  -.003  -.001  -.009  -.009  -.001  .003  -.002  .001]';

  

% dndr(alpha,beta)(-2:9)(-3:3)
CN3 = [ -.018  -.052  -.052  -.052  -.054  -.049  -.059  -.051  -.030  -.037  -.026  -.013;
      -.028  -.051  -.043  -.046  -.045  -.049  -.057  -.052  -.030  -.033  -.030  -.008;
      -.037  -.041  -.038  -.040  -.040  -.038  -.037  -.030  -.027  -.024  -.019  -.013; 
      -.048  -.045  -.045  -.045  -.044  -.045  -.047  -.048  -.049  -.045  -.033  -.016;
      -.043  -.044  -.041  -.041  -.040  -.038  -.034  -.035  -.035  -.029  -.022  -.009;
      -.052  -.034  -.036  -.036  -.035  -.028  -.024  -.023  -.020  -.016  -.010  -.014;
      -.062  -.034  -.027  -.028  -.027  -.027  -.023  -.023  -.019  -.009  -.025  -.010 ]';  







%% Dampings

% AoA(-2:9)
Damp =[-0.267   -0.110   0.308    1.34     2.08     2.91     2.76     2.05     1.50    1.49    1.83    1.21;
       0.882    0.852    0.876    0.958    0.962    0.974    0.819    0.483    0.590   1.21   -0.493  -1.04;
      -0.108   -0.108   -0.188    0.110    0.258    0.226    0.344    0.362    0.611   0.529   0.298  -0.227;
      -8.80    -25.8    -28.9    -31.4    -31.2    -30.7    -27.7    -28.2    -29.0   -29.8   -38.3   -35.3;
      -0.126   -0.026    0.063    0.113    0.208    0.230    0.319    0.437    0.680   0.100   0.447  -0.330;
      -0.360   -0.359   -0.443   -0.420   -0.383   -0.375   -0.329   -0.294   -0.230  -0.210  -0.120  -0.100;
      -7.21    -5.40    -5.23    -5.26    -6.11    -6.64    -5.69    -6.00    -6.20   -6.40   -6.60   -6.00;
      -0.380   -0.363   -0.378   -0.386   -0.370   -0.453   -0.550   -0.582   -0.595  -0.637  -1.02   -0.840;
       0.061    0.052    0.052   -0.012   -0.013   -0.024    0.050    0.150    0.130   0.158   0.240   0.150 ];
    
%C(alpha)(-2:9)   
CXq = Damp(1,:);    
CYr = Damp(2,:);
CYp = Damp(3,:);
CZq = Damp(4,:);
CLr = Damp(5,:);
CLp = Damp(6,:);
CMq = Damp(7,:);
CNr = Damp(8,:);
CNp = Damp(9,:);    

%% F16 matrice ~ 20000 ft 600 ft/sec  xcg = 0.3
% x = [Va    ;   h   ;   alpha   ; theta   ;   q    ;  power ;    beta  ;    phi   ;    p     ;   r  ;  psi]
A =[-0.0131    0.0000   21.6813  -31.6936   -0.8206    0.2280    0.0000   -0.0000   -0.0000   -0.0000   0
    -0.0000         0 -591.0404  591.0404         0         0         0    0.0000         0         0   0
    -0.0002    0.0000   -0.7485   -0.0000    0.9482   -0.0000   -0.0000         0    0.0000    0.0000   0
          0         0         0         0    1.0000         0         0         0         0         0   0
     0.0000   -0.0000   -1.4588         0   -0.8897         0   -0.0000         0         0   -0.0029   0
          0         0         0         0         0   -1.0000         0         0         0         0   0
     0.0000   -0.0000    0.0000   -0.0000   -0.0000    0.0000   -0.1967    0.0527    0.0594   -0.9941   0
          0         0         0         0         0         0         0         0    1.0000    0.0595   0
    -0.0000    0.0000    0.0000         0    0.0003         0  -19.6461         0   -2.3178    0.4926   0
    -0.0000    0.0000    0.0000         0    0.0025         0    7.5107         0   -0.0294   -0.3191   0
          0         0         0         0         0         0         0         0         0         1   0];





% u = [throttle ; elevator ; aileron ; rudder]
B = [    0     0.1094        0         0  
         0         0         0         0
         0   -0.0014         0         0
         0         0         0         0
         0   -0.1389         0         0
   34.3908         0         0         0
         0    0.0000    0.0002    0.0005
         0         0         0         0
         0         0   -0.5624    0.0983
         0         0   -0.0246   -0.0491
         0         0         0         0];



%output y = [an ; q ; alpha]
C = [    0.0033   -0.0000   14.3292    0    0.9659         0         0         0         0         0
         0         0         0         0    1.0000         0         0         0         0         0
         0         0   57.2958         0         0         0         0         0         0         0];

%output y = [Va ;   h    ;  alpha   ; theta   ;  q    ;  power ;   beta  ;    phi   ;    p     ;   r    ;   psi]
C = [    1.0000    0         0         0         0         0         0         0         0         0         0
         0    1.0000         0         0         0         0         0         0         0         0         0
         0         0   57.2958         0         0         0         0         0         0         0         0
         0         0         0   57.2958         0         0         0         0         0         0         0
         0         0         0         0   57.2958         0         0         0         0         0         0
         0         0         0         0         0         1         0         0         0         0         0
         0         0         0         0         0         0   57.2958         0         0         0         0
         0         0         0         0         0         0         0   57.2958         0         0         0
         0         0         0         0         0         0         0         0   57.2958         0         0
         0         0         0         0         0         0         0         0         0  57.2958          0 
         0         0         0         0         0         0         0         0         0         0   57.2958];

% bunu kullanacak mıyız???
D = [    0    0.0254         0         0
         0         0         0         0
         0         0         0         0];
     

D = [    0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0];     


     
     
%% F16 matrice ~ 15000 ft 500 ft/sec  xcg = 0.35
% % x = [Va    ;   h   ;   alpha   ; theta   ;   q    ;  power ;    beta  ;    phi   ;    p     ;   r]
% A =[-0.0151    0.0000   10.9540  -31.6936   -1.1127    0.2572    0.0000   -0.0000   -0.0000     0
%          0         0 -492.5337  492.5337         0         0         0    0.0000         0      0
%    -0.0003    0.0000   -0.7244   -0.0000    0.9380   -0.0000   -0.0000         0    0.0000      0
%          0         0         0         0    1.0000         0         0         0         0      0
%    -0.0000    0.0000    1.2193         0   -0.6784         0         0         0         0   -0.0029
%          0         0         0         0         0   -1.0000         0         0         0      0
%     0.0000   -0.0000    0.0000   -0.0000   -0.0000    0.0000   -0.1936    0.0632    0.0743    -0.9923
%          0         0         0         0         0         0         0         0    1.0000  0.0742
%     0.0000   -0.0000    0.0000         0    0.0003         0  -17.2478         0   -2.2605  0.5306
%    -0.0000    0.0000    0.0000         0    0.0025         0    5.5404         0   -0.0370  -0.3002];
% 
% 
% 
% 
% 
% % u = [throttle ; elevator ; aileron ; rudder]
% B = [    0    0.0773   -0.0000   -0.0000
%          0         0         0         0
%          0   -0.0014         0         0
%          0         0         0         0
%          0   -0.1094         0         0
%    33.8925         0         0         0
%          0    0.0000    0.0002    0.0005
%          0         0         0         0
%          0         0   -0.4625    0.0798
%          0         0   -0.0194   -0.0388];
% 
% 
% 
% %output y = [an ; q ; alpha]
% C = [    0.0033   -0.0000   14.3292    0    0.9659         0         0         0         0         0
%          0         0         0         0    1.0000         0         0         0         0         0
%          0         0   57.2958         0         0         0         0         0         0         0];
% 
% %output y = [Va ;   h    ;  alpha   ; theta   ;  q    ;  power ;   beta  ;    phi   ;    p     ;   r]
% C = [    1.0000    0         0         0         0         0         0         0         0         0
%          0    1.0000         0         0         0         0         0         0         0         0
%          0         0         1         0         0         0         0         0         0         0
%          0         0         0         1         0         0         0         0         0         0
%          0         0         0         0         1         0         0         0         0         0
%          0         0         0         0         0         1         0         0         0         0
%          0         0         0         0         0         0         1         0         0         0
%          0         0         0         0         0         0         0         1         0         0
%          0         0         0         0         0         0         0         0         1         0
%          0         0         0         0         0         0         0         0         0         1];
%     
% 
% % bunu kullanacak mıyız???
% D = [    0    0.0208         0         0
%          0         0         0         0
%          0         0         0         0];
%      
% 
% D = [    0         0         0         0
%          0         0         0         0
%          0         0         0         0
%          0         0         0         0
%          0         0         0         0
%          0         0         0         0
%          0         0         0         0
%          0         0         0         0
%          0         0         0         0
%          0         0         0         0];     

     
     

%% transfer functions

%% longitudinal

%for throttle
[a,b] = ss2tf(A(1:6,1:6),B(1:6,1),C(1:6,1:6),D(1:6,1));

GV_t = tf(a(1,:),b);
Gh_t = tf(a(2,:),b);
Galpha_t = tf(a(3,:),b);
Gtheta_t = tf(a(4,:),b);
Gq_t = tf(a(5,:),b);




%for elevator
[a,b] = ss2tf(A(1:6,1:6),B(1:6,2),C(1:6,1:6),D(1:6,2));

GV_e = tf(a(1,:),b);
Gh_e = tf(a(2,:),b);
Galpha_e = tf(a(3,:),b);
Gtheta_e = tf(a(4,:),b);
Gq_e = tf(a(5,:),b);



%% lateral

%for aileron
[a,b] = ss2tf(A(7:10,7:10),B(7:10,3),C(7:10,7:10),D(7:10,1));

Gbeta_a = tf(a(1,:),b);
Gphi_a = tf(a(2,:),b);
Gp_a = tf(a(3,:),b);
Gr_a = tf(a(4,:),b);




%for rudder
[a,b] = ss2tf(A(7:10,7:10),B(7:10,4),C(7:10,7:10),D(7:10,2));

Gbeta_r = tf(a(1,:),b);
Gphi_r = tf(a(2,:),b);
Gp_r = tf(a(3,:),b);
Gr_r = tf(a(4,:),b);



figure
subplot(2,2,1)
plot(out.tout,out.AoA)
xlabel('Time(sec)')
ylabel('AoA(deg)')
title('Angle of Attack')
ylim([-20 20])
grid

subplot(2,2,2)
plot(out.tout,out.airspeed)
xlabel('Time(sec)')
ylabel('Velocity(ft/sec)')
title('Airspeed')
ylim([550 650])
grid


subplot(2,2,3)
plot(out.tout,out.altitude)
xlabel('Time(sec)')
ylabel('Altitude(ft)')
title('Altitude')
ylim([19900 20100])
grid

subplot(2,2,4)
plot(out.tout,out.power)
xlabel('Time(sec)')
ylabel('Power(%)')
title('Power')
ylim([0 100])
grid


figure
subplot(2,3,4)
plot(out.tout,out.pitch_rate)
xlabel('Time(sec)')
ylabel('Pitch Rate(deg/sec)')
title('Pitch Rate')
ylim([-20 20])
grid

subplot(2,3,5)
plot(out.tout,out.roll_rate)
xlabel('Time(sec)')
ylabel('RollRate(deg/sec)')
title('Roll Rate')
ylim([-20 20])
grid

subplot(2,3,6)
plot(out.tout,out.yaw_rate)
xlabel('Time(sec)')
ylabel('Yaw Rate(deg/sec)')
title('Yaw Rate')
ylim([-20 20])
grid

subplot(2,3,1)
plot(out.tout,out.theta)
xlabel('Time(sec)')
ylabel('Theta(deg)')
title('Pitch Angle')
ylim([-25 25])
grid

subplot(2,3,2)
plot(out.tout,out.phi)
xlabel('Time(sec)')
ylabel('Phi(deg)')
title('Roll Angle')
ylim([-30 30])
grid

subplot(2,3,3)
plot(out.tout,out.psi)
xlabel('Time(sec)')
ylabel('Psi(deg)')
title('Yaw angle')
ylim([-25 25])
grid


figure
subplot(1,2,1)
plot(out.tout,out.el_rate)
xlabel('Time(sec)')
ylabel('Deflection Rate(deg/sec)')
title('Elevator Deflection Rate')
ylim([-40 80])
grid



subplot(1,2,2)
plot(out.tout,out.el_rate1)
xlabel('Time(sec)')
ylabel('Deflection Rate(deg/sec)')
title('Saturated Elevator Deflection Rate')
ylim([-40 80])
grid



t = 0:0.1:50;
figure
plot(t,out.noise)
xlabel('Time(sec)')
ylabel('Magnitude')
title('White Noise')
ylim([-.05,.05])
grid
